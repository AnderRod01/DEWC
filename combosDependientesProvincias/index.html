<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<title>Combos mySQL</title>

	<meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />

	<!-- Font Awesome -->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet" />
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
	<!-- MDB -->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.10.0/mdb.min.css" rel="stylesheet" />
	<!-- Bottstrap -->

	<!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>-->

	<script type="text/javascript">
		let peticion

		window.onload = function(){
			cargarProvincias()
			document.getElementById("provincia").onchange = cargarMunicipios
			document.getElementById("municipio").onchange = mostrarMensaje
		}

		function inicializarXhttp(){
			if (window.XMLHttpRequest){
				return new XMLHttpRequest()
			} else if(window.ActiveXObject){
				return new ActiveXObject("Microsoft.XMLHTTP")
			}
		}

		function cargarProvincias(){
			peticion = inicializarXhttp()
			if (peticion){
				peticion.onreadystatechange = muestraProvincias
				peticion.open("GET", "php/cargaProvinciasJSON.php", true)
				peticion.send()
			}
			muestraProvincias
		}

		function muestraProvincias(){
			if (peticion.readyState==4 && peticion.status == 200){
				console.log(peticion.responseText)
				
				let lista = document.getElementById("provincia")
				let provincias = eval('(' + peticion.responseText + ')')
				
				lista.options[0] = new Option("- Selecciona -")
				let i= 1
				for( let codigo in provincias){
					lista.options[i] = new Option(provincias[codigo], codigo)
					i++
				}
			}
		}

		function cargarMunicipios(){
			let lista = document.getElementById("provincia")
			let provincia = lista.options[lista.selectedIndex].value
			if(!isNaN(provincia)){
				peticion = inicializarXhttp()
				if (peticion){
					peticion.onreadystatechange = muestraMunicipios
					peticion.open("POST", "php/cargaMunicipiosJSON.php?nocache=" + Math.random(), true)
					peticion.setRequestHeader("Content-Type", "application/x-www-form-urlencoded")
					peticion.send("provincia=" + provincia)
				}
			}
		}

		function muestraMunicipios(){
			if (peticion.readyState==4 && peticion.status == 200){
				let lista = document.getElementById("municipio")
				let municipios = eval('(' + peticion.responsetext + ')')

				lista.options.length = 0
				let i= 0
				for(let codigo in municipios){
					lista.options[i] = new Option(municipios[codigo], codigo)
					i++
				}
			}
		}

		function mostrarMensaje(){

		}

	</script>
</head>

<body>
	
	<form action="">
		<div id="divprovincia">
			<label for="provincia">Provincia:</label>
			<select id="provincia" class="form-control"> </select>
		</div><br />
		<div id="divmunicipio">
			<label for="municipio">Municipio:</label>
			<select id="municipio" class="form-control"></select>
		</div>
		<div id="mensaje"></div>
	</form>
</body>

</html>